(function(){tinymce.create('tinymce.plugins.MoodlelangPlugin',{_langs:{},init:function(ed){this._langs=tinymce.util.JSON.parse(ed.getParam('moodlelang_langs'));ed.onInit.add(function(){ed.formatter.register('moodlelang_format',{inline:'span',classes:'multilang',attributes:{lang:'%lang'}})});ed.onNodeChange.add(function(ed,cm,n){var p,c,lang;c=cm.get('moodlelang');p=ed.dom.getParent(n,'SPAN');if(p&&ed.dom.hasClass(p,'multilang')){lang=ed.dom.getAttrib(p,'lang');c.select(lang)}else{c.select('')}})},createControl:function(n,cm){switch(n){case'moodlelang':var langMenu=cm.createListBox('moodlelang',{title:'moodlelang.language',onselect:function(v){if(tinymce.activeEditor.selection.getContent()!=''){v=v.trim();if(v!=''){tinymce.activeEditor.formatter.apply('moodlelang_format',{lang:v})}else{var getNextNode=function(node,endNode,skipChildren){if(endNode==node){return null}if(node.firstChild&&!skipChildren){return node.firstChild}if(!node.parentNode){return null}return node.nextSibling||getNextNode(node.parentNode,endNode,true)};var getNodesInRange=function(range){var startNode=range.startContainer.childNodes[range.startOffset]||range.startContainer;var endNode=range.endContainer.childNodes[range.endOffset]||range.endContainer;if(startNode==endNode&&startNode.childNodes.length===0){return[startNode]}var nodes=[];do{nodes.push(startNode)}while((startNode=getNextNode(startNode,endNode))&&(startNode!=endNode));return nodes};var nodes=getNodesInRange(tinymce.activeEditor.selection.getRng());for(var i=0;i<nodes.length;i++){parent=tinymce.activeEditor.dom.getParent(nodes[i],function(t){return tinymce.activeEditor.dom.getAttrib(t,'class')=='multilang'});if(parent){tinymce.activeEditor.dom.remove(parent,true)}}}}},});for(var lang in this._langs){langMenu.add(lang,this._langs[lang])}return langMenu}return null},getInfo:function(){return{longname:'Moodlelang plugin',author:'IÃ±aki Arenaza <iarenaza@mondragon.edu>',authorurl:'http://twitter.com/iarenaza',infourl:'http://moodle.org',version:"1.0"}},});tinymce.PluginManager.add('moodlelang',tinymce.plugins.MoodlelangPlugin)})();
